<h2><%= @title %></h2>

<%= if @title == "New Agent" do %>
  <form phx-change="search">
  <div class="search">
    <input type="search" class="input" name="search" phx-debounce="300" placeholder="名前、メールアドレスで絞り込み" value="<%= @search %>">
    <i class="icon fas fa-search"></i>
  </div>
  </form>
<% end %>

<%= f = form_for @changeset, "#",
  id: "agent-form",
  phx_target: @myself,
  phx_change: "validate",
  phx_submit: "save" %>

  <%= if @title == "New Agent" do %>
    <%= label f, :user_id, "ユーザ" %>
    <%= if @candidate != "" do %>
      <%= select f, :user_id, @candidate |> Enum.map( fn x -> {x.email <> " " <> x.last_name <> " " <> x.first_name, x.id} end ) %>
    <% end %>
  <% end %>
<!--
  <%= label f, :user_id, "ユーザID" %>
  <%= number_input f, :user_id %>
  <%= error_tag f, :user_id %>

  <%= label f, :agency_id, "代理店ID" %>
  <%= number_input f, :agency_id %>
  <%= error_tag f, :agency_id %>
-->
  <%= label f, :brand, "代理店名" %>
  <%= select f, :agency_id, @agencies |> Enum.map( fn x -> {x.brand, x.id} end ) %>
  <%= error_tag f, :agency_id %>

  <%= label f, :discount, "割引" %>
  <%= number_input f, :discount, step: "any" %>
  <%= error_tag f, :discount %>

  <%= label f, :boost, "ブースト" %>
  <%= number_input f, :boost, step: "any" %>
  <%= error_tag f, :boost %>
<!--
  <%= label f, :deleted_at %>
  <%= datetime_select f, :deleted_at %>
  <%= error_tag f, :deleted_at %>
-->
  <%= submit "Save", phx_disable_with: "Saving..." %>
</form>
